{"version":3,"file":"web.js","sourceRoot":"","sources":["../../src/web.ts"],"names":[],"mappings":"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","sourcesContent":["import { WebPlugin } from \"@capacitor/core\";\n\nimport type {\n  SocialLoginPlugin,\n  InitializeOptions,\n  LoginOptions,\n  LoginResult,\n  AuthorizationCode,\n  GoogleLoginResponse,\n  AppleProviderResponse,\n  isLoggedInOptions,\n  AuthorizationCodeOptions,\n  FacebookLoginOptions,\n  FacebookLoginResponse,\n  GoogleLoginOptions,\n} from \"./definitions\";\n\ndeclare const AppleID: any;\n\ndeclare const FB: {\n  init(options: any): void;\n  login(\n    callback: (response: {\n      status: string;\n      authResponse: { accessToken: string; userID: string };\n    }) => void,\n    options?: { scope: string },\n  ): void;\n  logout(callback: () => void): void;\n  api(\n    path: string,\n    params: { fields: string },\n    callback: (response: any) => void,\n  ): void;\n  getLoginStatus(\n    callback: (response: {\n      status: string;\n      authResponse?: { accessToken: string };\n    }) => void,\n  ): void;\n};\n\nexport class SocialLoginWeb extends WebPlugin implements SocialLoginPlugin {\n  private googleClientId: string | null = null;\n  private appleClientId: string | null = null;\n  private googleScriptLoaded = false;\n  private appleScriptLoaded = false;\n  private appleScriptUrl =\n    \"https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js\";\n  private facebookAppId: string | null = null;\n  private facebookScriptLoaded = false;\n\n  async initialize(options: InitializeOptions): Promise<void> {\n    if (options.google?.webClientId) {\n      this.googleClientId = options.google.webClientId;\n      await this.loadGoogleScript();\n    }\n    if (options.apple?.clientId) {\n      this.appleClientId = options.apple.clientId;\n      await this.loadAppleScript();\n    }\n    if (options.facebook?.appId) {\n      this.facebookAppId = options.facebook.appId;\n      await this.loadFacebookScript();\n      FB.init({\n        appId: this.facebookAppId,\n        version: \"v17.0\",\n        xfbml: true,\n        cookie: true,\n      });\n    }\n    // Implement initialization for other providers if needed\n  }\n\n  async login(options: LoginOptions): Promise<LoginResult> {\n    if (options.provider === \"google\") {\n      return this.loginWithGoogle(options.options);\n    } else if (options.provider === \"apple\") {\n      return this.loginWithApple(options.options);\n    } else if (options.provider === \"facebook\") {\n      return this.loginWithFacebook(options.options as FacebookLoginOptions);\n    }\n    // Implement login for other providers\n    throw new Error(`Login for ${options.provider} is not implemented on web`);\n  }\n\n  async logout(options: {\n    provider: \"apple\" | \"google\" | \"facebook\";\n  }): Promise<void> {\n    switch (options.provider) {\n      case \"google\":\n        // Google doesn't have a specific logout method for web\n        // We can revoke the token if we have it stored\n        console.log(\n          \"Google logout: Token should be revoked on the client side if stored\",\n        );\n        break;\n      case \"apple\":\n        // Apple doesn't provide a logout method for web\n        console.log(\n          \"Apple logout: Session should be managed on the client side\",\n        );\n        break;\n      case \"facebook\":\n        return new Promise<void>((resolve) => {\n          FB.logout(() => resolve());\n        });\n      default:\n        throw new Error(`Logout for ${options.provider} is not implemented`);\n    }\n  }\n\n  async isLoggedIn(\n    options: isLoggedInOptions,\n  ): Promise<{ isLoggedIn: boolean }> {\n    switch (options.provider) {\n      case \"google\":\n        // For Google, we can check if there's a valid token\n        // eslint-disable-next-line no-case-declarations\n        const googleUser = await this.getGoogleUser();\n        return { isLoggedIn: !!googleUser };\n      case \"apple\":\n        // Apple doesn't provide a method to check login status on web\n        console.log(\"Apple login status should be managed on the client side\");\n        return { isLoggedIn: false };\n      case \"facebook\":\n        return new Promise((resolve) => {\n          FB.getLoginStatus((response) => {\n            resolve({ isLoggedIn: response.status === \"connected\" });\n          });\n        });\n      default:\n        throw new Error(\n          `isLoggedIn for ${options.provider} is not implemented`,\n        );\n    }\n  }\n\n  async getAuthorizationCode(\n    options: AuthorizationCodeOptions,\n  ): Promise<AuthorizationCode> {\n    switch (options.provider) {\n      case \"google\":\n        // For Google, we can use the id_token as the authorization code\n        // eslint-disable-next-line no-case-declarations\n        const googleUser = await this.getGoogleUser();\n        if (googleUser?.credential) {\n          return { jwt: googleUser.credential };\n        }\n        throw new Error(\"No Google authorization code available\");\n      case \"apple\":\n        // Apple authorization code should be obtained during login\n        console.log(\"Apple authorization code should be stored during login\");\n        throw new Error(\"Apple authorization code not available\");\n      case \"facebook\":\n        return new Promise((resolve, reject) => {\n          FB.getLoginStatus((response) => {\n            if (response.status === \"connected\") {\n              resolve({ jwt: response.authResponse?.accessToken || \"\" });\n            } else {\n              reject(new Error(\"No Facebook authorization code available\"));\n            }\n          });\n        });\n      default:\n        throw new Error(\n          `getAuthorizationCode for ${options.provider} is not implemented`,\n        );\n    }\n  }\n\n  async refresh(options: LoginOptions): Promise<void> {\n    switch (options.provider) {\n      case \"google\":\n        // For Google, we can prompt for re-authentication\n        await this.loginWithGoogle(options.options);\n        break;\n      case \"apple\":\n        // Apple doesn't provide a refresh method for web\n        console.log(\"Apple refresh not available on web\");\n        break;\n      case \"facebook\":\n        await this.loginWithFacebook(options.options as FacebookLoginOptions);\n        break;\n      default:\n        throw new Error(`Refresh for ${options.provider} is not implemented`);\n    }\n  }\n\n  private async loginWithGoogle(\n    options: GoogleLoginOptions,\n  ): Promise<LoginResult> {\n    if (!this.googleClientId) {\n      throw new Error(\"Google Client ID not set. Call initialize() first.\");\n    }\n\n    const scopes = options.scopes || [\"email\", \"profile\"];\n\n    if (scopes.length > 0) {\n      // If scopes are provided, directly use the traditional OAuth flow\n      return this.fallbackToTraditionalOAuth(scopes);\n    }\n\n    return new Promise((resolve, reject) => {\n      google.accounts.id.initialize({\n        client_id: this.googleClientId!,\n        callback: (response) => {\n          console.log(\"google.accounts.id.initialize callback\", response);\n          if ((response as any).error) {\n            // we use any because type fail but we need to double check if that works\n            reject((response as any).error);\n          } else {\n            const payload = this.parseJwt(response.credential);\n            const result: GoogleLoginResponse = {\n              accessToken: null,\n              idToken: response.credential,\n              profile: {\n                email: payload.email || null,\n                familyName: payload.family_name || null,\n                givenName: payload.given_name || null,\n                id: payload.sub || null,\n                name: payload.name || null,\n                imageUrl: payload.picture || null,\n              },\n            };\n            resolve({ provider: \"google\", result });\n          }\n        },\n        auto_select: true,\n      });\n\n      google.accounts.id.prompt((notification) => {\n        if (notification.isNotDisplayed() || notification.isSkippedMoment()) {\n          console.log(\"OneTap is not displayed or skipped\");\n          // Fallback to traditional OAuth if One Tap is not available\n          this.fallbackToTraditionalOAuth(scopes).then(resolve).catch(reject);\n        } else {\n          console.log(\"OneTap is displayed\");\n        }\n      });\n    });\n  }\n\n  private parseJwt(token: string) {\n    const base64Url = token.split(\".\")[1];\n    const base64 = base64Url.replace(/-/g, \"+\").replace(/_/g, \"/\");\n    const jsonPayload = decodeURIComponent(\n      atob(base64)\n        .split(\"\")\n        .map((c) => {\n          return \"%\" + (\"00\" + c.charCodeAt(0).toString(16)).slice(-2);\n        })\n        .join(\"\"),\n    );\n    return JSON.parse(jsonPayload);\n  }\n\n  private async loadGoogleScript(): Promise<void> {\n    if (this.googleScriptLoaded) return;\n\n    return new Promise((resolve, reject) => {\n      const script = document.createElement(\"script\");\n      script.src = \"https://accounts.google.com/gsi/client\";\n      script.async = true;\n      script.onload = () => {\n        this.googleScriptLoaded = true;\n        resolve();\n      };\n      script.onerror = reject;\n      document.body.appendChild(script);\n    });\n  }\n\n  private async loginWithApple(options: any): Promise<LoginResult> {\n    if (!this.appleClientId) {\n      throw new Error(\"Apple Client ID not set. Call initialize() first.\");\n    }\n\n    if (!this.appleScriptLoaded) {\n      throw new Error(\"Apple Sign-In script not loaded.\");\n    }\n\n    return new Promise((resolve, reject) => {\n      AppleID.auth.init({\n        clientId: this.appleClientId!,\n        scope: options.scopes?.join(\" \") || \"name email\",\n        redirectURI: options.redirectUrl || window.location.href,\n        state: options.state,\n        nonce: options.nonce,\n        usePopup: true,\n      });\n\n      AppleID.auth\n        .signIn()\n        .then((res: any) => {\n          const result: AppleProviderResponse = {\n            profile: {\n              user: res.user?.name?.firstName\n                ? `${res.user.name.firstName} ${res.user.name.lastName}`\n                : \"\",\n              email: res.user?.email || null,\n              givenName: res.user?.name?.firstName || null,\n              familyName: res.user?.name?.lastName || null,\n            },\n            accessToken: {\n              token: res.authorization.code, // TODO: to fix and find the correct token\n            },\n            idToken: res.authorization.id_token || null,\n          };\n          resolve({ provider: \"apple\", result });\n        })\n        .catch((error: any) => {\n          reject(error);\n        });\n    });\n  }\n\n  private async loadAppleScript(): Promise<void> {\n    if (this.appleScriptLoaded) return;\n\n    return new Promise((resolve, reject) => {\n      const script = document.createElement(\"script\");\n      script.src = this.appleScriptUrl;\n      script.async = true;\n      script.onload = () => {\n        this.appleScriptLoaded = true;\n        resolve();\n      };\n      script.onerror = reject;\n      document.body.appendChild(script);\n    });\n  }\n\n  private async getGoogleUser(): Promise<any> {\n    return new Promise((resolve) => {\n      google.accounts.id.initialize({\n        client_id: this.googleClientId!,\n        callback: (response) => {\n          resolve(response);\n        },\n      });\n      google.accounts.id.prompt((notification) => {\n        if (notification.isNotDisplayed() || notification.isSkippedMoment()) {\n          resolve(null);\n        }\n      });\n    });\n  }\n\n  private async loadFacebookScript(): Promise<void> {\n    if (this.facebookScriptLoaded) return;\n\n    return new Promise((resolve, reject) => {\n      const script = document.createElement(\"script\");\n      script.src = \"https://connect.facebook.net/en_US/sdk.js\";\n      script.async = true;\n      script.defer = true;\n      script.onload = () => {\n        this.facebookScriptLoaded = true;\n        resolve();\n      };\n      script.onerror = reject;\n      document.body.appendChild(script);\n    });\n  }\n\n  private async loginWithFacebook(\n    options: FacebookLoginOptions,\n  ): Promise<LoginResult> {\n    if (!this.facebookAppId) {\n      throw new Error(\"Facebook App ID not set. Call initialize() first.\");\n    }\n\n    return new Promise((resolve, reject) => {\n      FB.login(\n        (response) => {\n          if (response.status === \"connected\") {\n            FB.api(\n              \"/me\",\n              { fields: \"id,name,email,picture\" },\n              (userInfo: any) => {\n                const result: FacebookLoginResponse = {\n                  accessToken: {\n                    token: response.authResponse.accessToken,\n                    userId: response.authResponse.userID,\n                  },\n                  profile: {\n                    userID: userInfo.id,\n                    name: userInfo.name,\n                    email: userInfo.email || null,\n                    imageURL: userInfo.picture?.data?.url || null,\n                    friendIDs: [],\n                    birthday: null,\n                    ageRange: null,\n                    gender: null,\n                    location: null,\n                    hometown: null,\n                    profileURL: null,\n                  },\n                  idToken: null,\n                };\n                resolve({ provider: \"facebook\", result });\n              },\n            );\n          } else {\n            reject(new Error(\"Facebook login failed\"));\n          }\n        },\n        { scope: options.permissions.join(\",\") },\n      );\n    });\n  }\n\n  private async fallbackToTraditionalOAuth(\n    scopes: string[],\n  ): Promise<LoginResult> {\n    return new Promise((resolve, reject) => {\n      const uniqueScopes = [...new Set([...scopes, \"openid\"])];\n      const auth2 = google.accounts.oauth2.initTokenClient({\n        client_id: this.googleClientId!,\n        scope: uniqueScopes.join(\" \"),\n        callback: async (response) => {\n          if (response.error) {\n            reject(response.error);\n          } else {\n            // Get ID token from userinfo endpoint\n            const userInfoResponse = await fetch(\n              \"https://www.googleapis.com/oauth2/v3/userinfo\",\n              {\n                headers: {\n                  Authorization: `Bearer ${response.access_token}`,\n                },\n              },\n            );\n            const userData = await userInfoResponse.json();\n\n            const result: GoogleLoginResponse = {\n              accessToken: {\n                token: response.access_token,\n              },\n              idToken: userData.sub, // Using sub as ID token\n              profile: {\n                email: userData.email || null,\n                familyName: userData.family_name || null,\n                givenName: userData.given_name || null,\n                id: userData.sub || null,\n                name: userData.name || null,\n                imageUrl: userData.picture || null,\n              },\n            };\n            resolve({ provider: \"google\", result });\n          }\n        },\n      });\n      auth2.requestAccessToken();\n    });\n  }\n}\n"]}